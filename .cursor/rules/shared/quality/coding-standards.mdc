---
description: General coding standards, non-negotiables, and code review checklist.
globs: **/*
---
# Coding Standards & Guidelines

## Core Principles
✅ **DRY (Don't Repeat Yourself)**: Extract common logic into shared utilities or components.
✅ **Succinctness**: Keep code and documentation direct and concise. Avoid wordiness.
✅ **Isolation**: Always maintain physical database isolation per tenant.

## What NOT to Do
❌ **NEVER** share databases between tenants.
❌ **NEVER** use shared-database multi-tenancy patterns.
❌ **NEVER** hardcode tenant IDs or connection strings.
❌ **NEVER** skip tenant isolation checks.
❌ **NEVER** use non-serverless infrastructure without justification.
❌ **NEVER** write backend code in JavaScript (use TypeScript).
❌ **NEVER** expose tenant data to other tenants.
❌ **NEVER** use `console.log/error/warn/info` in source code (use pino logger).

## What to Do
✅ **ALWAYS** maintain physical database isolation.
✅ **ALWAYS** use TypeScript for backend code.
✅ **ALWAYS** implement proper error handling.
✅ **ALWAYS** test tenant isolation.
✅ **ALWAYS** use serverless infrastructure.
✅ **ALWAYS** configure scale-to-zero for Cloud Run.
✅ **ALWAYS** store secrets securely.
✅ **ALWAYS** use structured logging via `@vendin/utils/logger` (pino).
✅ **ALWAYS** log with tenant context when applicable.

## Logging Standards

Use pino logger from `@vendin/utils` for all logging:

```typescript
import { createLogger } from '@vendin/utils/logger';

const logger = createLogger({
  logLevel: process.env.LOG_LEVEL,
  nodeEnv: process.env.NODE_ENV ?? 'development',
});

// Structured logging with context
logger.info({ tenantId, userId }, 'User action completed');
logger.error({ error, tenantId }, 'Operation failed');
```

**Enforcement:**
- ESLint rule `no-console: error` prevents console usage in source code
- Exception: Console allowed in test files for debugging
- See [utils-package.mdc](../../packages/utils-package.mdc) for logger implementation

## Code Review Checklist
- [ ] Tenant isolation maintained?
- [ ] Serverless infrastructure used?
- [ ] TypeScript used for backend?
- [ ] Secrets handled securely?
- [ ] Error handling implemented?
- [ ] Tests added/updated?
- [ ] Code is DRY and succinct?
- [ ] Pino logger used (no console.log)?

## Pre-Commit Verification

✅ **ALWAYS** verify changes pass Husky pre-commit hooks before committing.

After making code changes, run:
```bash
bun run lint && bun run typecheck
```
